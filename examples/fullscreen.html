<!DOCTYPE html>
<html>
<head>
    <title>SugarTV Card - Layout Example</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,700&amp;subset=cyrillic,cyrillic-ext,latin-ext" rel="stylesheet">
    <link href="https://overpass-30e2.kxcdn.com/overpass.css" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #111111;
            color: #FFFFFF;
            font-family: 'Roboto', sans-serif;
            container-type: inline-size;
        }

        .wrapper {
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100%;
            align-items: center;
            justify-content: center;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            line-height: 1;
            padding: 5cqi;
            box-sizing: border-box;
        }

        .main-row {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .time {
            font-size: 6cqi;
        }

        .value {
            font-size: 20cqi;
            margin: 0 2.5cqi;
        }

        .trend {
            font-size: 10cqi;
            font-family: 'overpass';
            margin: 0 2.5cqi 0 0;
        }

        .delta {
            font-size: 6cqi;
        }

        .prediction {
            font-size: 2.7cqi;
            margin-top: 2cqi;
            opacity: 0.7;
            text-align: center;
        }

        .controls {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }

        .controls button {
            background: #333;
            color: white;
            border: 1px solid #666;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 4px;
        }

        .controls button:hover {
            background: #444;
        }
    </style>
</head>
<body>
    <div class="controls">
        <button onclick="toggleTimeFormat()">Toggle Time Format</button>
        <button onclick="toggleUnit()">Toggle Unit</button>
    </div>
    <div class="wrapper">
        <div class="container">
            <div class="main-row">
                <div class="time">12:34</div>
                <div class="value">5.8</div>
                <div class="trend">→</div>
                <div class="delta">＋0.2</div>
            </div>
            <div class="prediction">Expected to rise 30-45 mg/dL in 15 minutes</div>
        </div>
    </div>

    <script>
        // Константы и настройки
        const UNITS = {
            MMOLL: { name: 'mmol/L', convert: v => v, convertDelta: d => d },
            MGDL: { 
                name: 'mg/dL', 
                convert: v => Math.round(v * 18), 
                convertDelta: d => Math.round(d * 18)
            }
        };

        const TIME_FORMATS = {
            H24: { hour: '2-digit', minute: '2-digit', hour12: false },
            H12: { hour: '2-digit', minute: '2-digit', hour12: true }
        };

        const TREND_SYMBOLS = {
            rising_quickly: { 
                symbol: '↑↑',
                predictions: {
                    MMOLL: 'Expected to rise over 2.5 mmol/L in 15 minutes',
                    MGDL: 'Expected to rise over 45 mg/dL in 15 minutes'
                }
            },
            rising: { 
                symbol: '↑',
                predictions: {
                    MMOLL: 'Expected to rise 1.7-2.5 mmol/L in 15 minutes',
                    MGDL: 'Expected to rise 30-45 mg/dL in 15 minutes'
                }
            },
            rising_slightly: { 
                symbol: '↗',
                predictions: {
                    MMOLL: 'Expected to rise 0.8-1.7 mmol/L in 15 minutes',
                    MGDL: 'Expected to rise 15-30 mg/dL in 15 minutes'
                }
            },
            steady: { 
                symbol: '→',
                predictions: {
                    MMOLL: 'Expected change of 0.8 mmol/L or less in 15 minutes',
                    MGDL: 'Expected change of 15 mg/dL or less in 15 minutes'
                }
            },
            falling_slightly: { 
                symbol: '↘',
                predictions: {
                    MMOLL: 'Expected to fall 0.8-1.7 mmol/L in 15 minutes',
                    MGDL: 'Expected to fall 15-30 mg/dL in 15 minutes'
                }
            },
            falling: { 
                symbol: '↓',
                predictions: {
                    MMOLL: 'Expected to fall 1.7-2.5 mmol/L in 15 minutes',
                    MGDL: 'Expected to fall 30-45 mg/dL in 15 minutes'
                }
            },
            falling_quickly: { 
                symbol: '↓↓',
                predictions: {
                    MMOLL: 'Expected to fall over 2.5 mmol/L in 15 minutes',
                    MGDL: 'Expected to fall over 45 mg/dL in 15 minutes'
                }
            }
        };

        // Состояние
        let currentValue = 5.8;
        let lastTrend = 'steady';
        let currentUnit = 'MMOLL';
        let currentTimeFormat = 'H24';

        // Функции переключения форматов
        function toggleTimeFormat() {
            currentTimeFormat = currentTimeFormat === 'H24' ? 'H12' : 'H24';
            updateDisplay();
        }

        function toggleUnit() {
            currentUnit = currentUnit === 'MMOLL' ? 'MGDL' : 'MMOLL';
            updateDisplay();
        }

        function getRandomTrend() {
            const trends = Object.keys(TREND_SYMBOLS);
            const currentIndex = trends.indexOf(lastTrend);
            const shift = Math.floor(Math.random() * 3) - 1;
            
            let newIndex = currentIndex + shift;
            if (newIndex < 0) newIndex = 0;
            if (newIndex >= trends.length) newIndex = trends.length - 1;
            
            lastTrend = trends[newIndex];
            return lastTrend;
        }

        function generateNextValue() {
            const trend = getRandomTrend();
            let change = 0;

            switch(trend) {
                case 'rising_quickly': change = 0.3 + Math.random() * 0.2; break;
                case 'rising': change = 0.2 + Math.random() * 0.1; break;
                case 'rising_slightly': change = 0.1 + Math.random() * 0.1; break;
                case 'steady': change = (Math.random() - 0.5) * 0.2; break;
                case 'falling_slightly': change = -(0.1 + Math.random() * 0.1); break;
                case 'falling': change = -(0.2 + Math.random() * 0.1); break;
                case 'falling_quickly': change = -(0.3 + Math.random() * 0.2); break;
            }

            currentValue = Math.max(3.0, Math.min(16.0, currentValue + change));
            
            const unit = UNITS[currentUnit];
            return {
                value: unit.convert(currentValue).toFixed(currentUnit === 'MMOLL' ? 1 : 0),
                trend: trend,
                delta: (change >= 0 ? '＋' : '－') + Math.abs(unit.convertDelta(change)).toFixed(currentUnit === 'MMOLL' ? 1 : 0)
            };
        }

        function updateDisplay() {
            const time = new Date().toLocaleTimeString([], TIME_FORMATS[currentTimeFormat]);
            const { value, trend, delta } = generateNextValue();

            document.querySelector('.time').textContent = time;
            document.querySelector('.value').textContent = value;
            document.querySelector('.trend').textContent = TREND_SYMBOLS[trend].symbol;
            document.querySelector('.delta').textContent = delta;
            document.querySelector('.prediction').textContent = TREND_SYMBOLS[trend].predictions[currentUnit];
        }

        // Обновляем значения каждые 5 секунд
        updateDisplay();
        setInterval(updateDisplay, 5000);
    </script>
</body>
</html> 